<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Signal backup database schema</title><link href=/default.css rel=stylesheet><body><nav><a href=/>‚Üê Homepage</a></nav><main><article><header><h1>Signal backup database schema</h1><section><small> Posted <time datetime=2021-12-23>Thursday, 23 December 2021</time><br> </small></section></header><p>I have a Signal for Android backup (from around 2020) that I wanted to extract messages from. I used <a href=https://github.com/mossblaser/signal_for_android_decryption>signal_for_android_decryption</a> to decrypt that backup and extra an SQLite database from it. These are my notes from trying to reverse-engineer the database schema, which is not well-documented, to extract the messages I wanted.<p>In retrospect, I didn't have to "reverse engineer" the schema since the source code for Signal for Android is <a href=https://github.com/signalapp/Signal-Android>publicly available</a> but (1) I didn't think of that at the time and (2) I'm not confident in my Java / Kotlin skills anyway. See also <a href=https://github.com/signalapp/Signal-Android/issues/7586>signalapp/Signal-Android#7586</a>.<p>If I ever revisit this (which I probably will), I'll probably take a look at the source code and update these notes. (I wrote this in a hurry, so don't take this as gospel.)<ul><li><p>Signal for Android commingles Signal group messages and direct messages with carrier SMS and MMS. The exported database has all of these. My goal was to retrieve Signal group messages and direct messages to certain recipients.</p><li><p>There are a few immediately interesting tables:</p> <ul><li><code>sms</code><li><code>mms</code><li><code>recipient</code></ul><li><p>Messages are split between <code>sms</code> and <code>mms</code> in ways that aren't 100% clear to me. SSM/MMS/Signal messages are apparently present in both tables. Received Signal group messages are in <code>sms</code> but messages I send to the same group might be in <code>mms</code>?</p><li><p>Determining messages that I sent and messages that I received appears non-trivial. <code>sms.service_center</code> appears null for messages I send, and non-null for messages I receive.</p><li><p>Maybe if, through Signal, your reply to a message, it ends up in <code>mms</code>.</p><li><p><code>mms.m_type = 132</code> for received messages, <code>mms.m_type = 128</code> for sent messages?</p><li><p>Threads and addresses -- threads are, roughly, conversations (DMs with individuals or group messages). I say "roughly" because I don't think they are comprehensive -- may be scattered between sms/mms tables.</p><li><p>Addresses are roughly "people" -- see the recipients table.</p></ul></article></main><footer><small> Background <a href=https://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a> <a href=https://www.heropatterns.com/>Steve Schoger</a>.<br> <a href=https://github.com/natanlao/natanlao.github.io>View source</a>. </small></footer>